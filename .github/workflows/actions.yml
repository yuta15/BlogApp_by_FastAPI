name: Run test when pushed code
run-name: ${{ github.actor }} is pushed!!!!!!

on: [push]

jobs:
    Blog_app_job:
        name: Blog app job
        runs-on: ubuntu-latest
        env:
            ENV: 'Dev'
            ALGORITHM: ${{ secrets.ALGORITHM }}
            DB_USERNAME: ${{ secrets.DB_USERNAME }}
            DB_PASSWORD: ${{ secrets.DB_PASSWORD}}
            DB_HOSTNAME: 'db'
            DB_PORT: 3306
            DB_NAME: ${{ vars.MYSQL_DATABASE }}
        services:
            db:
                image: mysql:latest
                ports:
                    - 3306:3306
                env:
                    MYSQL_ROOT_PASSWORD: ${{ secrets.MYSQL_ROOT_PASSWORD }}
                    MYSQL_DATABASE: ${{ env.MYSQL_DATABASE }}
                    MYSQL_USER: ${{ secrets.DB_USERNAME }}
                    MYSQL_PASSWORD: ${{ secrets.DB_PASSWORD }}
                options: >-
                    --health-cmd="mysqladmin ping --silent"
                    --health-interval=10s
                    --health-timeout=5s
                    --health-retries=3

        steps:
            - name: Check out repository code
              uses: actions/checkout@v4

            - name: check current_dir
              run: ls -la
            
            - name: install dependencies
              working-directory: docker/app
              run: |
                   ls -la &&\
                   pip install --upgrade pip &&\
                   pip install -r requirements.txt
            
            - name: execute test
              run: pytest -svv
